swagger: "2.0"
info:
  title: MediSupply API
  version: "1.0.0"

basePath: /
schemes: ["https"]
consumes: ["application/json"]
produces: ["application/json"]

parameters:
  CountryHeader:
    name: X-Country
    in: header
    required: true
    type: string

  ProductoIdParam:
    name: producto_id
    in: path
    required: true
    type: string
    format: uuid

  ProveedorIdParam:
    name: proveedor_id
    in: path
    required: true
    type: string
    format: uuid

  OrdenCompraIdParam:
    name: oc_id
    in: path
    required: true
    type: string
    format: uuid

  PedidoIdParam:
    name: pedido_id
    in: path
    required: true
    type: string
    format: uuid

  UsuarioIdParam:
    name: usuario_id
    in: path
    required: true
    type: integer
    format: int64

  RutaIdParam:
    name: ruta_id
    in: path
    required: true
    type: string
    format: uuid

  ParadaIdParam:
    name: parada_id
    in: path
    required: true
    type: string
    format: uuid

definitions:
  ErrorResponse:
    type: object
    properties:
      message: { type: string }
      code: { type: integer, format: int32 }

  Pedido:
    type: object
    properties:
      id: { type: string }
      status: { type: string }
      created_at: { type: string, format: date-time }

  MeResponse:
    type: object
    properties:
      sub: { type: string }
      email: { type: string }
      name: { type: string }
      roles:
        type: array
        items: { type: string }

  ItemOCIn:
    type: object
    required: [producto_id, cantidad]
    properties:
      producto_id: { type: string, format: uuid }
      cantidad: { type: integer, format: int32, minimum: 1 }
      precio_unitario: { type: number, format: double }
      impuesto_pct: { type: number, format: double, minimum: 0, maximum: 100 }
      descuento_pct: { type: number, format: double, minimum: 0, maximum: 100 }
      sku_proveedor: { type: string }

  OrdenCompraCreate:
    type: object
    required: [proveedor_id, items]
    properties:
      proveedor_id: { type: string, format: uuid }
      pedido_ref:   { type: string, format: uuid }
      moneda:       { type: string, minLength: 1, maxLength: 3 }
      notas:        { type: string, maxLength: 500 }
      codigo:       { type: string, maxLength: 32 }
      items:
        type: array
        items: { $ref: "#/definitions/ItemOCIn" }

  ItemOCOut:
    allOf:
      - $ref: "#/definitions/ItemOCIn"
      - type: object
        properties:
          id:   { type: string, format: uuid }
          oc_id: { type: string, format: uuid }

  OrdenCompraOut:
    type: object
    properties:
      id:          { type: string, format: uuid }
      codigo:      { type: string }
      proveedor_id: { type: string, format: uuid }
      pedido_ref:  { type: string, format: uuid }
      estado:      { type: string, enum: [ABIERTA, ENVIADA, PARCIAL, COMPLETA, CANCELADA] }
      subtotal:    { type: number, format: double }
      impuesto_total: { type: number, format: double }
      total:       { type: number, format: double }
      moneda:      { type: string }
      notas:       { type: string }
      items:
        type: array
        items: { $ref: "#/definitions/ItemOCOut" }

  PedidoTipo:
    type: string
    enum: [COMPRA, VENTA]

  PedidoEstado:
    type: string
    enum: [BORRADOR, APROBADO, EN_TRANSITO, RECIBIDO, DESPACHADO, CANCELADO]

  PedidoItemIn:
    type: object
    required: [producto_id, cantidad]
    properties:
      producto_id:  { type: string, format: uuid }
      cantidad:     { type: integer, format: int32, minimum: 1 }
      precio_unitario: { type: number, format: double }
      impuesto_pct: { type: number, format: double, minimum: 0, maximum: 100 }
      descuento_pct: { type: number, format: double, minimum: 0, maximum: 100 }
      sku:          { type: string }

  # Nota: Swagger 2.0 no soporta oneOf; definimos un esquema flexible
  PedidoCreate:
    type: object
    description: >
      Para COMPRA: requiere proveedor_id (uuid) y bodega_destino_id.
      Para VENTA: requiere cliente_id (int), vendedor_id (int) y bodega_origen_id.
    required: [tipo, items]
    properties:
      tipo: { $ref: "#/definitions/PedidoTipo" }
      # COMPRA
      proveedor_id:      { type: string, format: uuid }
      bodega_destino_id: { type: string, format: uuid }
      # VENTA
      cliente_id:        { type: integer, format: int32 }
      vendedor_id:       { type: integer, format: int32 }
      bodega_origen_id:  { type: string, format: uuid }
      # comunes
      observaciones:     { type: string, maxLength: 500 }
      items:
        type: array
        items: { $ref: "#/definitions/PedidoItemIn" }

  PedidoOut:
    type: object
    properties:
      id:           { type: string, format: uuid }
      codigo:       { type: string }
      tipo:         { $ref: "#/definitions/PedidoTipo" }
      estado:       { $ref: "#/definitions/PedidoEstado" }
      subtotal:     { type: number, format: double }
      impuesto_total: { type: number, format: double }
      total:        { type: number, format: double }
      creado_en:    { type: string, format: date-time }
      actualizado_en: { type: string, format: date-time }

paths:
  /v1/pedidos:
    get:
      operationId: Pedidos_List
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar pedidos
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: tipo
          in: query
          type: string
          required: false
          description: "COMPRA|VENTA"
        - name: estado
          in: query
          type: string
          required: false
          description: "BORRADOR|APROBADO|EN_TRANSITO|RECIBIDO|DESPACHADO|CANCELADO"
        - name: limit
          in: query
          type: integer
          format: int32
          default: 50
        - name: offset
          in: query
          type: integer
          format: int32
          default: 0
        - name: fecha_compromiso
          in: query
          type: string
          format: date
          required: false
          description: "Filtrar por fecha de compromiso exacta (AAAA-MM-DD)"
        - name: fc_desde
          in: query
          type: string
          format: date
          required: false
          description: "Filtrar desde fecha de compromiso (AAAA-MM-DD)"
        - name: fc_hasta
          in: query
          type: string
          format: date
          required: false
          description: "Filtrar hasta fecha de compromiso (AAAA-MM-DD)"
      responses:
        200:
          description: OK
        500: { description: Server error, schema: { $ref: "#/definitions/ErrorResponse" } }

    post:
      operationId: Pedidos_Create
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear un pedido (COMPRA o VENTA)
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema: { $ref: "#/definitions/PedidoCreate" }
      responses:
        201: { description: Creado, schema: { $ref: "#/definitions/PedidoOut" } }
        200: { description: OK,     schema: { $ref: "#/definitions/PedidoOut" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        500: { description: Server error, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightPedidos
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }


  /v1/pedidos/{pedido_id}:
    get:
      operationId: Pedidos_GetById
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Obtener un pedido por ID
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/PedidoIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/PedidoOut" } }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightPedidosById
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/PedidoIdParam"
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/pedidos/{pedido_id}/marcar-recibido:
    post:
      operationId: Pedidos_MarcarRecibido
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Marcar pedido de COMPRA como recibido
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/PedidoIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/PedidoOut" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found,   schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightPedidosRecibido
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/PedidoIdParam"
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/pedidos/{pedido_id}/marcar-despachado:
    post:
      operationId: Pedidos_MarcarDespachado
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Marcar pedido de VENTA como despachado
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/PedidoIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/PedidoOut" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found,   schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightPedidosDespachado
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/PedidoIdParam"
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/pedidos/{pedido_id}/cancelar:
    post:
      operationId: Pedidos_Cancelar
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Cancelar pedido
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/PedidoIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/PedidoOut" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found,   schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightPedidosCancelar
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/PedidoIdParam"
      x-google-backend:
        address: "${MS_PEDIDOS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }


  /v1/inventario/producto:
    post:
      operationId: producto_crear
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [sku, nombre]
            properties:
              sku: { type: string }
              nombre: { type: string }
              categoria: { type: string }
              controlado: { type: boolean }
              temp_min: { type: number, format: float }
              temp_max: { type: number, format: float }
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioProducto
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/producto/{producto_id}/certificacion:
    post:
      operationId: producto_certificacion
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Agregar certificación a producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProductoIdParam"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [autoridad, tipo, vigencia]
            properties:
              autoridad: { type: string }
              tipo: { type: string }
              vigencia: { type: string, format: date-time }
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioProductoCertificacion
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/bodega:
    post:
      operationId: bodega_crear
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear bodega
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [direccion, ciudad, pais]
            properties:
              direccion: { type: string }
              ciudad: { type: string }
              pais: { type: string }
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioBodega
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/ubicacion:
    post:
      operationId: ubicacion_crear
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear ubicación
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [bodega_id, pasillo, estante, posicion]
            properties:
              bodega_id: { type: string, format: uuid }
              pasillo: { type: string }
              estante: { type: string }
              posicion: { type: string }
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioUbicacion
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/lote:
    post:
      operationId: lote_crear
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear lote
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [producto_id, codigo]
            properties:
              producto_id: { type: string, format: uuid }
              codigo: { type: string }
              vencimiento: { type: string, format: date-time }
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioLote
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/entrada:
    post:
      operationId: registro_entrada
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Registrar entrada
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [lote_id, ubicacion_id, cantidad]
            properties:
              lote_id: { type: string, format: uuid }
              ubicacion_id: { type: string, format: uuid }
              cantidad: { type: integer, format: int32 }
              estado: { type: string }
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioEntrada
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/salida/fefo:
    post:
      operationId: registro_salida
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Salida FEFO
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: producto_id
          in: query
          required: true
          type: string
          format: uuid
        - name: cantidad
          in: query
          required: true
          type: integer
          format: int32
        - name: ubicacion_id
          in: query
          required: false
          type: string
          format: uuid
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioSalidaFefo
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/stock/{producto_id}:
    get:
      operationId: stock_total_producto
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Stock total por producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProductoIdParam"
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioStock
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/stock/{producto_id}/detalle:
    get:
      operationId: detalle_stock_producto
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Detalle de stock por producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProductoIdParam"
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioStockDetalle
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/producto/{producto_id}/detalle:
    get:
      operationId: detalle_producto
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Detalle de producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProductoIdParam"
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioProductoDetalle
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/producto/{producto_id}/ubicaciones:
    get:
      operationId: stock_producto_ubicaciones
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Ubicaciones con stock del producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProductoIdParam"
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioProductoUbicaciones
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/inventario/productos/todos:
    get:
      operationId: productos_todos
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar todos los productos (paginado)
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: limit
          in: query
          type: integer
          format: int32
          default: 50
        - name: offset
          in: query
          type: integer
          format: int32
          default: 0
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightInventarioProductosTodos
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_INVENTARIO_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/auth/login:
    post:
      operationId: Auth_Login
      security: []   # explícitamente sin auth
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Login (emite JWT)
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [username, password]
            properties:
              username: { type: string }
              password: { type: string }
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              access_token:  { type: string }
              refresh_token: { type: string }
              token_type:    { type: string }
              expires_in:    { type: integer, format: int32 }
        401: { description: Unauthorized, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightAuthLogin
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/usuarios:
    get:
      operationId: Usuarios_Listar
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar usuarios
      description: Devuelve la lista de usuarios filtrando opcionalmente por rol.
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: role
          in: query
          required: false
          type: string
          enum: [admin, institutional_customer, seller]
          description: Rol por el que se filtra.
        - name: offset
          in: query
          required: false
          type: integer
          format: int32
          minimum: 0
          default: 0
          description: Desplazamiento para paginación.
        - name: limit
          in: query
          required: false
          type: integer
          format: int32
          minimum: 1
          maximum: 1000
          default: 100
          description: Tamaño de página.
      responses:
        200:
          description: OK
          schema:
            type: array
            items:
              $ref: "#/definitions/UserResponse"
        400:
          description: Bad request
          schema: { $ref: "#/definitions/ErrorResponse" }
        401:
          description: Unauthorized
          schema: { $ref: "#/definitions/ErrorResponse" }
        500:
          description: Server error
          schema: { $ref: "#/definitions/ErrorResponse" }

    options:
      operationId: CorsPreflightUsuarios
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/auth/register:
    post:
      operationId: Auth_Register
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Register user
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [username, role, institution_name, password]
            properties:
              username: { type: string }
              role: { type: string }
              institution_name: { type: string }
              password: { type: string }
      responses:
        201: { description: Created }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightAuthRegister
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/auth/refresh:
    post:
      operationId: Auth_Refresh
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Refresh token
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [refresh_token]
            properties:
              refresh_token: { type: string }
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              access_token:  { type: string }
              token_type:    { type: string }
              expires_in:    { type: integer, format: int32 }
        401: { description: Unauthorized, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightAuthRefresh
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/usuarios/me:
    get:
      operationId: Usuarios_Me
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Perfil del usuario autenticado
      parameters:
        - $ref: "#/parameters/CountryHeader"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/MeResponse" } }
        401: { description: Unauthorized, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightUsuariosMe
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/proveedores:
    post:
      operationId: Proveedores_Crear
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear proveedor
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema:
            type: object
      responses:
        201: { description: Creado }
        409: { description: Conflicto (documento/pais existente), schema: { $ref: "#/definitions/ErrorResponse" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }

    get:
      operationId: Proveedores_Listar
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar proveedores
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: q
          in: query
          type: string
          required: false
          description: Búsqueda por nombre/documento
        - name: pais
          in: query
          type: string
          required: false
        - name: activo
          in: query
          type: boolean
          required: false
        - name: limit
          in: query
          type: integer
          format: int32
          default: 50
        - name: offset
          in: query
          type: integer
          format: int32
          default: 0
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightProveedores
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }


  /v1/proveedores/{proveedor_id}:
    get:
      operationId: Proveedores_Detalle
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Obtener proveedor por ID
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProveedorIdParam"
      responses:
        200: { description: OK }
        404: { description: No encontrado, schema: { $ref: "#/definitions/ErrorResponse" } }

    patch:
      operationId: Proveedores_Actualizar
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Actualizar proveedor
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProveedorIdParam"
        - name: body
          in: body
          required: true
          schema: { type: object }
      responses:
        200: { description: OK }
        404: { description: No encontrado, schema: { $ref: "#/definitions/ErrorResponse" } }
        409: { description: Conflicto (documento/pais), schema: { $ref: "#/definitions/ErrorResponse" } }

    delete:
      operationId: Proveedores_Eliminar
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Eliminar proveedor
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProveedorIdParam"
      responses:
        204: { description: No Content }
        404: { description: No encontrado, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightProveedoresById
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProveedorIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }


  /v1/proveedores/{proveedor_id}/productos:
    post:
      operationId: Proveedores_AsociarProducto
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Asociar producto a proveedor (upsert)
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProveedorIdParam"
        - name: body
          in: body
          required: true
          schema: { type: object }
      responses:
        201: { description: Creado/Actualizado }
        404: { description: Proveedor no encontrado, schema: { $ref: "#/definitions/ErrorResponse" } }

    get:
      operationId: Proveedores_ListarProductos
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar productos de un proveedor
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProveedorIdParam"
        - name: activo
          in: query
          type: boolean
          required: false
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightProveedoresProductos
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProveedorIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }


  /v1/proveedores/{proveedor_id}/productos/{producto_id}:
    delete:
      operationId: Proveedores_DesasociarProducto
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Desasociar producto de proveedor
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProveedorIdParam"
        - $ref: "#/parameters/ProductoIdParam"
      responses:
        204: { description: No Content }
        404: { description: Relación no encontrada, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflightProveedoresProductosById
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProveedorIdParam"
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }


  /v1/proveedores/{producto_id}/proveedores:
    get:
      operationId: Productos_ListarProveedores
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar proveedores para un producto
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ProductoIdParam"
        - name: activo_relacion
          in: query
          type: boolean
          required: false
        - name: activo_proveedor
          in: query
          type: boolean
          required: false
        - name: limit
          in: query
          type: integer
          format: int32
          default: 50
        - name: offset
          in: query
          type: integer
          format: int32
          default: 0
      responses:
        200: { description: OK }

    options:
      operationId: CorsPreflightProductosProveedores
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ProductoIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/ordenes-compra:
    post:
      operationId: OC_Crear
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Crear Orden de Compra
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: body
          in: body
          required: true
          schema: { $ref: "#/definitions/OrdenCompraCreate" }
      responses:
        201:
          description: Created
          schema: { $ref: "#/definitions/OrdenCompraOut" }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found,   schema: { $ref: "#/definitions/ErrorResponse" } }
        500: { description: Server error, schema: { $ref: "#/definitions/ErrorResponse" } }

    get:
      operationId: OC_Listar
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar Órdenes de Compra
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: proveedor_id
          in: query
          type: string
          format: uuid
          required: false
        - name: estado
          in: query
          type: string
          required: false
          description: ABIERTA|ENVIADA|PARCIAL|COMPLETA|CANCELADA
        - name: q
          in: query
          type: string
          required: false
          description: Búsqueda por código
        - name: limit
          in: query
          type: integer
          format: int32
          default: 50
        - name: offset
          in: query
          type: integer
          format: int32
          default: 0
      responses:
        200:
          description: OK
          schema:
            type: array
            items: { $ref: "#/definitions/OrdenCompraOut" }
        500: { description: Server error, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflight_OC_List_Create
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/ordenes-compra/{oc_id}:
    get:
      operationId: OC_Obtener
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Obtener Orden de Compra por ID
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/OrdenCompraIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/OrdenCompraOut" } }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }

    delete:
      operationId: OC_Eliminar
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Eliminar Orden de Compra
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/OrdenCompraIdParam"
      responses:
        204: { description: No Content }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflight_OC_ById
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/OrdenCompraIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/ordenes-compra/{oc_id}/marcar-enviada:
    post:
      operationId: OC_MarcarEnviada
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Marcar OC como ENVIADA
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/OrdenCompraIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/OrdenCompraOut" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflight_OC_Enviada
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/OrdenCompraIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/ordenes-compra/{oc_id}/marcar-completa:
    post:
      operationId: OC_MarcarCompleta
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Marcar OC como COMPLETA
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/OrdenCompraIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/OrdenCompraOut" } }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflight_OC_Completa
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/OrdenCompraIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/ordenes-compra/{oc_id}/cancelar:
    post:
      operationId: OC_Cancelar
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Cancelar Orden de Compra
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/OrdenCompraIdParam"
      responses:
        200: { description: OK, schema: { $ref: "#/definitions/OrdenCompraOut" } }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }

    options:
      operationId: CorsPreflight_OC_Cancelar
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/OrdenCompraIdParam"
      x-google-backend:
        address: "${MS_COMPRAS_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/usuarios/usuario/{usuario_id}:
    get:
      operationId: Usuarios_GetById
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Obtener usuario por ID
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/UsuarioIdParam"
      responses:
        200: { description: OK }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }
    options:
      operationId: CorsPreflightUsuariosGetById
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/UsuarioIdParam"
      x-google-backend:
        address: "${MS_USUARIOS_AUTENTICACION_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/logistica/rutas/generar:
    post:
      operationId: Logistica_GenerarRutasPorFecha
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Generar rutas por fecha y tipo de pedido
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: fecha
          in: query
          required: true
          type: string
          format: date
        - name: tipo
          in: query
          required: true
          type: string
          enum: [VENTA, COMPRA]
      responses:
        202: { description: Rutas en proceso de generación }
        200: { description: Rutas generadas }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
    options:
      operationId: CorsPreflightLogisticaGenerar
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/logistica/rutas:
    get:
      operationId: Logistica_ListarRutasPorFecha
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Listar rutas por fecha
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - name: fecha
          in: query
          required: true
          type: string
          format: date
      responses:
        200: { description: OK }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
    options:
      operationId: CorsPreflightLogisticaRutas
      summary: CORS preflight
      security: []
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/logistica/rutas/{ruta_id}:
    get:
      operationId: Logistica_GetRutaById
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Obtener ruta por ID
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/RutaIdParam"
      responses:
        200: { description: OK }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }
    options:
      operationId: CorsPreflightLogisticaRutaById
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/RutaIdParam"
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }

  /v1/logistica/paradas/{parada_id}/estado:
    patch:
      operationId: Logistica_ActualizarEstadoParada
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      summary: Actualizar estado de una parada
      parameters:
        - $ref: "#/parameters/CountryHeader"
        - $ref: "#/parameters/ParadaIdParam"
        - name: body
          in: body
          required: true
          schema:
            type: object
            required: [estado]
            properties:
              estado:
                type: string
                description: "Ej: PENDIENTE|EN_CAMINO|ENTREGADA|FALLIDA"
      responses:
        200: { description: OK }
        400: { description: Bad request, schema: { $ref: "#/definitions/ErrorResponse" } }
        404: { description: Not found, schema: { $ref: "#/definitions/ErrorResponse" } }
    options:
      operationId: CorsPreflightLogisticaParadaEstado
      summary: CORS preflight
      security: []
      parameters:
        - $ref: "#/parameters/ParadaIdParam"
      x-google-backend:
        address: "${MS_LOGISTICA_URL}"
        path_translation: "APPEND_PATH_TO_ADDRESS"
        disable_auth: true
      responses:
        204: { description: No Content }
